# TodoFlow - Architecture Diagrams

This document contains comprehensive diagrams illustrating the TodoFlow application architecture, data models, state flows, and data flows.

---

## 1. Entity Relationship Diagram

This diagram shows the data model and entity structure.

```mermaid
erDiagram
    TODO {
        string id PK "UUID generated by crypto.randomUUID()"
        string text "Task description"
        boolean completed "Completion status"
        Date createdAt "Creation timestamp"
        Date updatedAt "Last modification timestamp"
    }

    LOCALSTORAGE {
        string key "todos-app-data"
        json value "Serialized Todo array"
    }

    FILTER_STATE {
        string filter "all | active | completed"
    }

    STATS {
        number total "Total todo count"
        number active "Incomplete todo count"
        number completed "Completed todo count"
    }

    TODO ||--o{ LOCALSTORAGE : "persisted in"
    TODO ||--|| FILTER_STATE : "filtered by"
    TODO }|--|| STATS : "aggregated into"
```

---

## 2. State Flow Diagram

This diagram shows how todo items transition between different states.

```mermaid
stateDiagram-v2
    [*] --> Active: User adds new todo

    Active --> Completed: User clicks checkbox (toggleTodo)
    Completed --> Active: User unchecks checkbox (toggleTodo)

    Active --> Editing: User clicks edit button
    Editing --> Active: User saves changes (updateTodo)
    Editing --> Active: User cancels (Escape key)

    Completed --> Editing: User clicks edit button
    Editing --> Completed: User saves changes (updateTodo)

    Active --> [*]: User clicks delete (deleteTodo)
    Completed --> [*]: User clicks delete (deleteTodo)
    Completed --> [*]: User clicks "Clear Completed"
    Editing --> [*]: User clicks delete while editing

    state Active {
        [*] --> Visible
        Visible --> Hidden: Filter changed to "completed"
        Hidden --> Visible: Filter changed to "all" or "active"
    }

    state Completed {
        [*] --> Visible
        Visible --> Hidden: Filter changed to "active"
        Hidden --> Visible: Filter changed to "all" or "completed"
    }

    note right of Active
        New todos start as Active
        (completed: false)
    end note

    note right of Completed
        Checked todos become Completed
        (completed: true)
    end note

    note right of Editing
        Local state in TodoItem component
        Temporary until saved/cancelled
    end note
```

---

## 3. Complete End-to-End Data Flow

```mermaid
graph TD
    %% User Interactions
    User[ðŸ‘¤ User] --> UI[ðŸ–¥ï¸ User Interface]

    %% Initial Load
    UI -->|Page Load| Main[main.tsx<br/>Entry Point]
    Main --> App[App.tsx<br/>Root Component]
    App -->|Mount Effect| UseTodos[useTodos Hook<br/>State Management]
    UseTodos -->|loadTodos| Storage[storage.ts<br/>localStorage Utils]
    Storage -->|Read from| LocalStorage[(Browser localStorage<br/>Key: todos-app-data)]
    LocalStorage -->|Return Todo Array| Storage
    Storage -->|Deserialize JSON<br/>Convert dates| UseTodos
    UseTodos -->|Initial State| App

    %% Component Tree
    App --> TodoForm[TodoForm.tsx<br/>Add New Todo]
    App --> TodoFilter[TodoFilter.tsx<br/>Filter Tabs]
    App --> TodoStats[TodoStats.tsx<br/>Progress & Actions]
    App --> TodoItem[TodoItem.tsx<br/>Individual Todo]

    %% Add Todo Flow
    TodoForm -->|User types & submits| AddTodo[addTodo callback]
    AddTodo -->|Create new Todo<br/>crypto.randomUUID| UseTodos
    UseTodos -->|Update State<br/>setTodos| ReactState[React State<br/>todos Array]

    %% Toggle Todo Flow
    TodoItem -->|Click checkbox| ToggleTodo[toggleTodo callback]
    ToggleTodo -->|Update completed status| UseTodos

    %% Edit Todo Flow
    TodoItem -->|Edit & save text| UpdateTodo[updateTodo callback]
    UpdateTodo -->|Update text & updatedAt| UseTodos

    %% Delete Todo Flow
    TodoItem -->|Click delete| DeleteTodo[deleteTodo callback]
    DeleteTodo -->|Filter out todo| UseTodos

    %% Bulk Actions
    TodoStats -->|Clear completed| ClearCompleted[clearCompleted callback]
    TodoStats -->|Toggle all| ToggleAll[toggleAll callback]
    ClearCompleted --> UseTodos
    ToggleAll --> UseTodos

    %% Filter Flow
    TodoFilter -->|Change filter| SetFilter[setFilter callback]
    SetFilter -->|Update filter state| UseTodos
    UseTodos -->|Apply filter logic| FilteredTodos[Filtered Todos]
    FilteredTodos --> TodoItem

    %% Auto-Save Effect
    ReactState -->|useEffect triggers on change| SaveTodos[saveTodos function]
    SaveTodos -->|Serialize to JSON| Storage
    Storage -->|Write to| LocalStorage

    %% Stats Calculation
    UseTodos -->|Calculate stats| Stats[Stats Object<br/>total, active, completed]
    Stats --> TodoFilter
    Stats --> TodoStats

    %% Styling
    classDef userClass fill:#4F46E5,stroke:#4338CA,color:#fff
    classDef componentClass fill:#3B82F6,stroke:#2563EB,color:#fff
    classDef hookClass fill:#8B5CF6,stroke:#7C3AED,color:#fff
    classDef storageClass fill:#10B981,stroke:#059669,color:#fff
    classDef stateClass fill:#F59E0B,stroke:#D97706,color:#fff
    classDef callbackClass fill:#EC4899,stroke:#DB2777,color:#fff

    class User userClass
    class UI,App,TodoForm,TodoFilter,TodoStats,TodoItem,Main componentClass
    class UseTodos,FilteredTodos,Stats hookClass
    class Storage,LocalStorage storageClass
    class ReactState stateClass
    class AddTodo,ToggleTodo,UpdateTodo,DeleteTodo,ClearCompleted,ToggleAll,SetFilter,SaveTodos callbackClass
```

---

## 4. Complete Application Lifecycle

This sequence diagram shows the complete lifecycle from app initialization to user interactions.

```mermaid
sequenceDiagram
    participant User
    participant Browser
    participant Main as main.tsx
    participant App as App.tsx
    participant Hook as useTodos Hook
    participant Storage as storage.ts
    participant LS as localStorage

    Note over Browser,LS: Application Initialization

    Browser->>Main: Load application
    Main->>App: Mount React app
    App->>Hook: Initialize useTodos hook
    Hook->>Storage: Call loadTodos()
    Storage->>LS: localStorage.getItem('todos-app-data')
    LS-->>Storage: Return JSON string
    Storage->>Storage: JSON.parse() & convert dates
    Storage-->>Hook: Return Todo array
    Hook-->>App: Return initial state + callbacks
    App->>App: Render UI components

    Note over User,LS: User Adds New Todo

    User->>App: Type text & submit
    App->>Hook: Call addTodo(text)
    Hook->>Hook: Generate UUID, create Todo object
    Hook->>Hook: setTodos([newTodo, ...prev])
    Hook->>Storage: useEffect triggers saveTodos()
    Storage->>LS: localStorage.setItem(key, JSON.stringify(todos))
    Hook-->>App: Re-render with new todo
    App-->>User: Display new todo in list

    Note over User,LS: User Toggles Todo

    User->>App: Click checkbox
    App->>Hook: Call toggleTodo(id)
    Hook->>Hook: Update todo.completed = !completed
    Hook->>Hook: setTodos(updated array)
    Hook->>Storage: useEffect triggers saveTodos()
    Storage->>LS: localStorage.setItem(key, JSON.stringify(todos))
    Hook-->>App: Re-render with updated todo
    App-->>User: Display checked/unchecked todo

    Note over User,LS: User Edits Todo

    User->>App: Click edit, modify text, save
    App->>Hook: Call updateTodo(id, newText)
    Hook->>Hook: Update todo.text & todo.updatedAt
    Hook->>Hook: setTodos(updated array)
    Hook->>Storage: useEffect triggers saveTodos()
    Storage->>LS: localStorage.setItem(key, JSON.stringify(todos))
    Hook-->>App: Re-render with updated text
    App-->>User: Display edited todo

    Note over User,LS: User Deletes Todo

    User->>App: Click delete button
    App->>Hook: Call deleteTodo(id)
    Hook->>Hook: Filter out todo from array
    Hook->>Hook: setTodos(filtered array)
    Hook->>Storage: useEffect triggers saveTodos()
    Storage->>LS: localStorage.setItem(key, JSON.stringify(todos))
    Hook-->>App: Re-render without deleted todo
    App-->>User: Todo removed from list

    Note over User,LS: User Changes Filter

    User->>App: Click filter tab (All/Active/Completed)
    App->>Hook: Call setFilter(filterType)
    Hook->>Hook: Update filter state
    Hook->>Hook: Apply filter logic to todos
    Hook-->>App: Return filtered todos
    App-->>User: Display filtered list
```

---

## Legend

- **Purple (User)**: User interaction layer
- **Blue (Components)**: React components and UI elements
- **Violet (Hooks)**: State management and business logic
- **Green (Storage)**: Persistence layer (localStorage)
- **Orange (State)**: React state container
- **Pink (Callbacks)**: Action handlers and functions

## Key Data Flow Patterns

### 1. Initial Load (App Startup)
```
Browser â†’ main.tsx â†’ App.tsx â†’ useTodos (mount effect) â†’
storage.loadTodos() â†’ localStorage â†’ Parse & Deserialize â†’
Initial State â†’ Render Components
```

### 2. Add New Todo
```
User Input â†’ TodoForm â†’ addTodo() â†’ useTodos (create Todo with UUID) â†’
React setState â†’ Auto-save effect â†’ storage.saveTodos() â†’ localStorage
```

### 3. Toggle/Edit/Delete Todo
```
User Action â†’ TodoItem â†’ callback (toggle/update/delete) â†’
useTodos (modify state) â†’ React setState â†’ Auto-save effect â†’
storage.saveTodos() â†’ localStorage
```

### 4. Filter Todos
```
User Click â†’ TodoFilter â†’ setFilter() â†’ useTodos (update filter state) â†’
Apply filter logic â†’ Return filtered todos â†’ Re-render TodoItem list
```

### 5. Automatic Persistence
```
Any State Change â†’ React useEffect (line 14-16 in useTodos.ts) â†’
storage.saveTodos() â†’ JSON.stringify() â†’ localStorage.setItem()
```

## Important Notes

- **No Backend**: All data stays in the browser's localStorage
- **Automatic Saves**: Every state change triggers an automatic save (useEffect dependency on `todos`)
- **Single Source of Truth**: The `useTodos` hook is the only place that manages state
- **Unidirectional Flow**: Data flows down via props, actions flow up via callbacks
- **Presentational Components**: All components are "dumb" - they receive props and call callbacks
